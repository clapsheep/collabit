# [TIL] Redis를 우리 프로젝트에 사용해야 하는 이유

- 날짜 : 2025-01-13

# Redis (Remote Dictionary Server)

- 오픈 소스 기반 고성능 키-값 저장소
- NoSQL 데이터베이스 중 하나
- 캐싱, 세션 관리, 메시지 브로커, 대기열 처리 등에 활용
- 메모리 내 데이터 저장으로 빠른 응답 속도를 제공하며 디스크에 데이터를 지속적으로 저장하여 데이터 손실을 방지
- 다양한 데이터 구조 지원, 문자열, 리스트, 해시, 집합, 정렬집합과 같은 데이터 타입을 다룰 수 있음
- Pub-Sub 메커니즘을 통한 메시지 브로커
- 클라이언트 간 메시지 전달 및 이벤트 기반 아키텍처에 활용
- Key-value 저장소중 1위

### 특징

- 인메모리 데이터베이스 : 데이터를 메모리에 저장해 빠른 응답 속도
- 다양한 데이터 타입
- 영속성 : 디스크에 데이터를 주기적으로 저장해 데이터 지속성 제공
- Pub-Sub 메시징 : 메시지 브로커로 사용
- 트랜잭션 싱글 스레드 → 안정성
- 클러스터링 : 데이터 샤딩, 레플리케이션을 통한 고가용성 및 확장성을 제공하는 클러스터 구성 가능
  - 샤딩 : 같은 테이블 스키마를 가진 데이터를 다수의 데이터베이스에 분산하여 저장하는 방법
- LRU 및 만료 시간

### 캐시(Cache)

- 한번 조회된 데이터를 미리 특정 공간에 저장해놓고 똑같은 요청이 발생하면 저장해둔 데이터를 제공해 빠르게 서비스 제공
- Redis Cache는 메모리단에 위치해 용량은 작지만 접근 속도가 빠름

# 활용사례

→ 운영중인 웹 서버에서 키-값 형태의 데이터 타입을 처리해야 하고 I/O가 빈번히 발생해 다른 저장 방식을 사용하면 효율이 떨어지는 경우에 사용

### 트위터

- 타임라인에서 15만명이 넘는 실시간 활동 사용자와 초당 30만 건이 넘는 타임라인 요청 응답 속도를 향상시키기 위해 Redis 사용
- 트위터 데이터센터의 레디스클러스터는 타임라인에 노출된 트윗의 정보를 리스트 형태로 약 800개 정도 캐싱
- 타임라인 요청이 발생하면 캐싱된 정보를 먼저 가져오고 이를 토대로 쿼리를 단순화해 데이터베이스에 접근하여 처리

### 주로 사용하는 곳

- 인증 토큰 저장
- API 캐싱 → 동일 여청에 대해 캐싱된 데이터 리턴
- 채팅
- 좋아요, 조회수 처리 → 댓글 번호를 key, 좋아요 누른 회원ID를 item 추가
- 일일 방문자수
- 최근 검색 목록 sorted set
- 출석 이벤트
- 랭킹
- 이벤트 알림

# 채팅 외부 브로커 비교

### **RabbitMQ**

- 다양한 비즈니스에 의한 복잡한 라우팅 설계에 적합한 메시지 브로커
- AMQP를 사용하여 지점 간 방법과 게시-구독 방법을 통해 메시지를 전달한다.
  - AMQP(Advanced Message Queuing Protocols): 애플리케이션간에 데이터를 주고받을 때, 메시지 미들웨어 브로커를 통해 데이터를 주고받을 수 있게 해주는 메시징 프로토콜
- 신뢰성 있는 메시지를 전송할 수 있기 때문에 정확한 요청-응답이 필요하거나, 트래픽은 작지만 장시간 실행되고 안정적인 작업이 필요한 경우에 사용할 수 있다.

### **Redis**

- 고성능 Key-Value 저장소 또는 메시지 브로커로 사용할 수 있는 인메모리 데이터 저장소이다.
- Pub/Sub 기능
  - 다른 메시지 브로커와 다르게 메시지 지속성이 없다.
    - 즉, 메시지를 전송한 후 해당 메시지는 삭제되고 Redis 어디에도 저장되지 않는다.
    - 따라서 channel에 구독하고 있지 않으면 메시지가 유실 될 수 있다. 또한, 채팅방의 채팅이 많아질 경우 채팅 순서가 보장되지 않을 수 있다.
    - 메시지 전송 신뢰성을 보장하지 않기 때문에 단점을 보완할 별도의 추가 구현(Redis Streams)이 필요할 수 있다.
- 실시간으로 빠르게 데이터 처리를 해야하는 서비스와 인메모리 데이터베이스로 인해 지속성이 중요하지 않고, 일정 수준의 손실을 처리할 수 있는 짧은 보존 메시지에 적합하다.

### **Kafka**

- 대량의 데이터를 저장하면서 높은 처리량이 필요한 곳에 적합한 메시지 브로커
- Pub/Sub 모델의 메시지 큐로 분산환경에 특화되어 있는 특징을 가지는 서버이다.
  - 다수의 서버가 하나의 서비스를 이루는 경우, kafka를 이용하여 분산처리를 하는데 각 서버가 통신하는 방식은 Pub/Sub을 이용한다.
  - 이 Pub/Sub 메시지들은 메시지 큐의 형태로 순차적으로 처리되며, 모든 메시지들은 로그로 처리된다.
  - 이 특성을 이용하면 서비스의 안정성을 확보할 수 있다.

⇒ 채팅 기록을 남길 거라면 Kafka, 아니라면 Redis

# 결론! 우리 프로젝트에 적용할 부분

- JWT 인증 토큰 저장 (Refresh Token)
- API 캐싱 → 동일 요청에 대해 캐싱된 데이터 리턴 (프로필)
- 게시판 좋아요, 조회수 처리 → 댓글 번호를 key, 좋아요 누른 회원ID를 item 추가
- 최근 검색 목록 sorted set → 이건 혹시 게시판에 검색 기능 있는 경우 활용 가능
- 랭킹 → 좋아요, 조회수 데이터를 기준으로 한 랭킹
- 이벤트 알림 → 리뷰나 채팅 알림을 띄운다면…
- 채팅 → Kafka가 더 적합하지 않을까? 이전 사람과의 채팅을 남길 거라면!
